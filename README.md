# no-xx-under-18
Sex website for video Publishing and marketing
Create a new Spring Boot project
Use Spring Initializr (Maven, Java 17+, dependencies: spring-web, spring-boot-starter-thymeleaf, spring-boot-starter-validation, spring-boot-starter-data-jpa, spring-boot-starter-security if desired).Example entities & controller// src/main/java/com/example/site/model/WebsiteOwner.java
package com.example.site.model;

import jakarta.persistence.*;
import jakarta.validation.constraints.*;

@Entity
public class WebsiteOwner {

    @Id
        @GeneratedValue(strategy = GenerationType.IDENTITY)
            private Long id;

                @NotBlank private String name;
                    @Email @NotBlank private String email;
                        @NotBlank private String username;

                            // Do NOT store in passwords — hash them!
                                @NotBlank private String passwordHash;

                                    private String logoPath;

                                        // getters & setters...
                                        }// src/main/java/com/example/site/controller/OwnerController.java
                                        package com.example.site.controller;

                                        import com.example.site.model.WebsiteOwner;
                                        import com.example.site.repo.WebsiteOwnerRepository;
                                        import org.springframework.beans.factory.annotation.Autowired;
                                        import org.springframework.stereotype.Controller;
                                        import org.springframework.ui.Model;
                                        import org.springframework.web.bind.annotation.*;
                                        import org.springframework.web.multipart.MultipartFile;

                                        import java.nio.file.*;

                                        @Controller
                                        @RequestMapping("/owner")
                                        public class OwnerController {

                                            @Autowired
                                                private WebsiteOwnerRepository repo;

                                                    @GetMapping("/register")
                                                        public String registerForm(Model model) {
                                                                model.addAttribute("owner", new WebsiteOwner());
                                                                        return "register";
                                                                            }

                                                                                @PostMapping("/register")
                                                                                    public String register(
                                                                                                @ModelAttribute WebsiteOwner owner,
                                                                                                            @RequestParam("logo") MultipartFile logoFile
                                                                                                                ) throws Exception {

                                                                                                                        if (!logoFile.isEmpty()) {
                                                                                                                                    Path uploadDir = Paths.get("uploads/logos");
                                                                                                                                                Files.createDirectories(uploadDir);
                                                                                                                                                            Path filePath = uploadDir.resolve(logoFile.getOriginalFilename());
                                                                                                                                                                        Files.copy(logoFile.getInputStream(), filePath, StandardCopyOption.REPLACE_EXISTING);
                                                                                                                                                                                    owner.setLogoPath("/uploads/logos/" + logoFile.getOriginalFilename());
                                                                                                                                                                                            }

                                                                                                                                                                                                    // TODO: hash password and integrate Firebase user creation
                                                                                                                                                                                                            // owner.setPasswordHash(passwordEncoder.encode(rawPassword));

                                                                                                                                                                                                                    repo.save(owner);
                                                                                                                                                                                                                            return "redirect:/owner/dashboard";
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                }Simple theme (dark grey, orange text, yellow line, blue-green buttons)/* src/main/resources/static/styles.css */
                                                                                                                                                                                                                                body {
                                                                                                                                                                                                                                  background: #2b2b2b;        /* dark grey */
                                                                                                                                                                                                                                    color: #ff8c00;              /* orange text tone */
                                                                                                                                                                                                                                      font-family: Arial, sans-serif;
                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                      .header-line {
                                                                                                                                                                                                                                        border-bottom: 3px solid #ffd700; /* yellow-gold */
                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                        button, .btn {
                                                                                                                                                                                                                                          background: #1e6fdc;  /* blue */
                                                                                                                                                                                                                                            border: none;
                                                                                                                                                                                                                                              padding: 8px 14px;
                                                                                                                                                                                                                                                border-radius: 6px;
                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                button:hover {
                                                                                                                                                                                                                                                  background: #2aa84a;  /* green on hover */
                                                                                                                                                                                                                                                  }Example Thymeleaf form<!-- src/main/resources/templates/register.html -->
                                                                                                                                                                                                                                                  <!DOCTYPE html>
                                                                                                                                                                                                                                                  <html xmlns:th="http://www.thymeleaf.org">
                                                                                                                                                                                                                                                  <head>
                                                                                                                                                                                                                                                    <link rel="stylesheet" href="/styles.css">
                                                                                                                                                                                                                                                      <title>No XX Under 18 — Owner Setup</title>
                                                                                                                                                                                                                                                      </head>
                                                                                                                                                                                                                                                      <body>
                                                                                                                                                                                                                                                        <div class="header-line">
                                                                                                                                                                                                                                                            <h1>No XX Under 18 — Owner Registration</h1>
                                                                                                                                                                                                                                                              </div>

                                                                                                                                                                                                                                                                <form th:action="@{/owner/register}" th:object="${owner}" method="post" enctype="multipart/form-data">
                                                                                                                                                                                                                                                                    <label>Name</label>
                                                                                                                                                                                                                                                                        <input th:field="*{name}" required>

                                                                                                                                                                                                                                                                            <label>Email</label>
                                                                                                                                                                                                                                                                                <input th:field="*{email}" type="email" required>

                                                                                                                                                                                                                                                                                    <label>Username</label>
                                                                                                                                                                                                                                                                                        <input th:field="*{username}" required>

                                                                                                                                                                                                                                                                                            <label>Logo</label>
                                                                                                                                                                                                                                                                                                <input type="file" name="logo" accept="image/*">

                                                                                                                                                                                                                                                                                                    <!-- For security, use a password field and hash it server-side -->
                                                                                                                                                                                                                                                                                                        <label>Password</label>
                                                                                                                                                                                                                                                                                                            <input type="password" name="password" required>

                                                                                                                                                                                                                                                                                                                <button type="submit">Create Account</button>
                                                                                                                                                                                                                                                                                                                  </form>
                                                                                                                                                                                                                                                                                                                  </body>
                                                                                                                                                                                                                                                                                                                  </html>Create a Firebase project
                                                                                                                                                                                                                                                                                                                  Enable Email/Password auth
                                                                                                                                                                                                                                                                                                                  From your Java backend, use the Firebase Admin SDK to:
                                                                                                                                                                                                                                                                                                                  create users
                                                                                                                                                                                                                                                                                                                  verify ID tokens on protected routes// Initialize Firebase Admin in a @Configuration class
                                                                                                                                                                                                                                                                                                                  FirebaseOptions options = FirebaseOptions.builder()
                                                                                                                                                                                                                                                                                                                      .setCredentials(GoogleCredentials.fromStream(serviceAccount))
                                                                                                                                                                                                                                                                                                                          .build();
                                                                                                                                                                                                                                                                                                                          FirebaseApp.initializeApp(options);src/
                                                                                                                                                                                                                                                                                                                           ├─ main/java/com/example/site
                                                                                                                                                                                                                                                                                                                            │   ├─ config/FirebaseConfig.java
                                                                                                                                                                                                                                                                                                                             │   ├─ controller/AgeGateController.java
                                                                                                                                                                                                                                                                                                                              │   ├─ controller/OwnerController.java
                                                                                                                                                                                                                                                                                                                               │   ├─ controller/DashboardController.java
                                                                                                                                                                                                                                                                                                                                │   ├─ model/WebsiteOwner.java
                                                                                                                                                                                                                                                                                                                                 │   ├─ repo/WebsiteOwnerRepository.java
                                                                                                                                                                                                                                                                                                                                  │   └─ security/AuthFilter.java
                                                                                                                                                                                                                                                                                                                                   └─ main/resources
                                                                                                                                                                                                                                                                                                                                        ├─ templates/
                                                                                                                                                                                                                                                                                                                                             │   ├─ age-gate.html
                                                                                                                                                                                                                                                                                                                                                  │   ├─ register.html
                                                                                                                                                                                                                                                                                                                                                       │   ├─ dashboard.html
                                                                                                                                                                                                                                                                                                                                                            │   └─ login.html
                                                                                                                                                                                                                                                                                                                                                                 ├─ static/styles.css
                                                                                                                                                                                                                                                                                                                                                                      └─ application.ymlapplication.yml (use env vars for secrets)server:
                                                                                                                                                                                                                                                                                                                                                                        port: 8080

                                                                                                                                                                                                                                                                                                                                                                        app:
                                                                                                                                                                                                                                                                                                                                                                          uploads: uploads/logos

                                                                                                                                                                                                                                                                                                                                                                          firebase:
                                                                                                                                                                                                                                                                                                                                                                            serviceAccount: ${FIREBASE_SERVICE_ACCOUNT}Firebase Configuration (Admin SDK)// src/main/java/com/example/site/config/FirebaseConfig.java
                                                                                                                                                                                                                                                                                                                                                                            package com.example.site.config;

                                                                                                                                                                                                                                                                                                                                                                            import com.google.auth.oauth2.GoogleCredentials;
                                                                                                                                                                                                                                                                                                                                                                            import com.google.firebase.FirebaseApp;
                                                                                                                                                                                                                                                                                                                                                                            import com.google.firebase.FirebaseOptions;
                                                                                                                                                                                                                                                                                                                                                                            import org.springframework.context.annotation.Configuration;

                                                                                                                                                                                                                                                                                                                                                                            import java.io.ByteArrayInputStream;
                                                                                                                                                                                                                                                                                                                                                                            import java.nio.charset.StandardCharsets;

                                                                                                                                                                                                                                                                                                                                                                            @Configuration
                                                                                                                                                                                                                                                                                                                                                                            public class FirebaseConfig {

                                                                                                                                                                                                                                                                                                                                                                                public FirebaseConfig() throws Exception {
                                                                                                                                                                                                                                                                                                                                                                                        if (FirebaseApp.getApps().isEmpty()) {
                                                                                                                                                                                                                                                                                                                                                                                                    String json = System.getenv("FIREBASE_SERVICE_ACCOUNT");
                                                                                                                                                                                                                                                                                                                                                                                                                FirebaseOptions options = FirebaseOptions.builder()
                                                                                                                                                                                                                                                                                                                                                                                                                                    .setCredentials(GoogleCredentials.fromStream(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                new ByteArrayInputStream(json.getBytes(StandardCharsets.UTF_8))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        .build();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    FirebaseApp.initializeApp(options);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }Model// src/main/java/com/example/site/model/WebsiteOwner.java
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                package com.example.site.model;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import jakarta.persistence.*;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import jakarta.validation.constraints.*;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @Entity
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                public class WebsiteOwner {

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    @Id
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @GeneratedValue(strategy = GenerationType.IDENTITY)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            private Long id;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @NotBlank private String name;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    @Email @NotBlank private String email;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @NotBlank private String username;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Store only a Firebase UID, not a password
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                private String firebaseUid;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    private String logoPath;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // getters & setters...
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }Repository// src/main/java/com/example/site/repo/WebsiteOwnerRepository.java
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        package com.example.site.repo;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        import com.example.site.model.WebsiteOwner;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        import org.springframework.data.jpa.repository.JpaRepository;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        import java.util.Optional;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        public interface WebsiteOwnerRepository extends JpaRepository<WebsiteOwner, Long> {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Optional<WebsiteOwner> findByUsername(String username);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }Age-Gate (18+)// src/main/java/com/example/site/controller/AgeGateController.java
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            package com.example.site.controller;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            import jakarta.servlet.http.HttpSession;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            import org.springframework.stereotype.Controller;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            import org.springframework.web.bind.annotation.*;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            @Controller
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            public class AgeGateController {

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @GetMapping("/")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    public String ageGate() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return "age-gate";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    @PostMapping("/confirm-age")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        public String confirmAge(HttpSession session) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                session.setAttribute("age_verified", true);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return "redirect:/owner/login";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }<!-- templates/age-gate.html -->
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <!DOCTYPE html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <head>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <link rel="stylesheet" href="/styles.css">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <title>Adults Only (18+)</title>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </head>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="header-line"><h1>Adults Only — 18+</h1></div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <p>You must confirm that you are 18 or older to continue.</p>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <form action="/confirm-age" method="post">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <button type="submit">I am 18 or Older</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </form>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </html>Registration + Logo Upload + Firebase User
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // src/main/java/com/example/site/controller/OwnerController.java
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                package com.example.site.controller;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import com.example.site.model.WebsiteOwner;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import com.example.site.repo.WebsiteOwnerRepository;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import com.google.firebase.auth.*;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import org.springframework.beans.factory.annotation.Autowired;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import org.springframework.stereotype.Controller;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import org.springframework.ui.Model;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import org.springframework.web.bind.annotation.*;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import org.springframework.web.multipart.MultipartFile;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import java.nio.file.*;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @Controller
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @RequestMapping("/owner")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                public class OwnerController {

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    @Autowired
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        private WebsiteOwnerRepository repo;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            @GetMapping("/register")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                public String registerForm(Model model) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        model.addAttribute("owner", new WebsiteOwner());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return "register";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @PostMapping("/register")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            public String register(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @ModelAttribute WebsiteOwner owner,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    @RequestParam("password") String password,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @RequestParam("logo") MultipartFile logoFile
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ) throws Exception {

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Create Firebase user
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    UserRecord.CreateRequest req = new UserRecord.CreateRequest()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    .setEmail(owner.getEmail())
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    .setPassword(password)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    .setDisplayName(owner.getUsername());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            UserRecord user = FirebaseAuth.getInstance().createUser(req);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    owner.setFirebaseUid(user.getUid());

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Upload logo
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!logoFile.isEmpty()) {
                       (Express — set cookie)// routes/age.js
                       const express = require("express");
                       const router = express.Router();
                       
                       router.post("/verify-age", (req, res) => {
                         const { confirmed } = req.body;
                           if (!confirmed) return res.status(400).json({ ok: false });
                           
                             res.cookie("age_verified", "true", {
                                 httpOnly: true,
                                     sameSite: "lax",
                                         maxAge: 1000 * 60 * 60 * 24 * 30
                                           });
                                           
                                             res.json({ ok: true });
                                             });
                                             
                                             module.exports = router;import { useEffect, useState } from "react";
                                             
                                             export default function AgeGate() {
                                               const [show, setShow] = useState(false);
                                               
                                                 useEffect(() => {
                                                     if (!document.cookie.includes("age_verified=true")) setShow(true);
                                                       }, []);
                                                       
                                                         const confirm = async () => {
                                                             await fetch("/api/verify-age", { method: "POST", body: JSON.stringify({ confirmed: true }), headers: { "Content-Type": "application/json" }});
                                                                 setShow(false);
                                                                   };
                                                                   
                                                                     if (!show) return null;
                                                                     
                                                                       return (
                                                                           <div className="modal">
                                                                                 <p>You must confirm you are 18+ to continue.</p>
                                                                                       <button onClick={confirm}>I am 18+</button>
                                                                                           </div>
                                                                                             );
                                                                                             }DB migrationALTER TABLE sites ADD COLUMN id uuid DEFAULT gen_random_uuid();
                                                                                             CREATE TABLE site_owners (
                                                                                               site_id uuid REFERENCES sites(id),
                                                                                                 user_id uuid REFERENCES users(id),
                                                                                                   role TEXT DEFAULT 'owner',
                                                                                                     PRIMARY KEY (site_id, user_id)
                                                                                                     );ALTER TABLE sites ADD COLUMN id uuid DEFAULT gen_random_uuid();
                                                                                                     CREATE TABLE site_owners (
                                                                                                       site_id uuid REFERENCES sites(id),
                                                                                                         user_id uuid REFERENCES users(id),
                                                                                                           role TEXT DEFAULT 'owner',
                                                                                                             PRIMARY KEY (site_id, user_id)
                                                                                                             );app.post("/sites/:id/owners", async (req, res) => {
                                                                                                                const { userId } = req.body;
                                                                                                                  await db("site_owners").insert({ site_id: req.params.id, user_id: userId });
                                                                                                                    res.json({ ok: true });
                                                                                                                    });ALTER TABLE content ADD COLUMN category TEXT;
                                                                                                                    CREATE INDEX content_category_idx ON content(category);app.get("/content", async (req, res) => {
                                                                                                                        const { category } = req.query;
                                                                                                                          const items = await db("content")
                                                                                                                              .modify(q => category && q.where({ category }))
                                                                                                                                  .orderBy("created_at", "desc");
                                                                                                                                    res.json(items);
                                                                                                                                    });ALTER TABLE images ADD COLUMN status TEXT DEFAULT 'pending';app.get("/moderation/images", async (_, res) => {
                                                                                                                                        res.json(await db("images").where({ status: "pending" }));
                                                                                                                                        });

                                                                                                                                        app.post("/moderation/images/:id/approve", async (req, res) => {
                                                                                                                                          await db("images").where({ id: req.params.id }).update({ status: "approved" });
                                                                                                                                            res.json({ ok: true });
                                                                                                                                            });Cloudflare R2 storage option
                                                                                                                                            Configimport { S3Client, PutObjectCommand } from "@aws-sdk/client-s3";

                                                                                                                                            const s3 = new S3Client({
                                                                                                                                              region: "auto",
                                                                                                                                                endpoint: process.env.R2_ENDPOINT,
                                                                                                                                                  credentials: {
                                                                                                                                                      accessKeyId: process.env.R2_KEY,
                                                                                                                                                          secretAccessKey: process.env.R2_SECRET
                                                                                                                                                            }
                                                                                                                                                            });

                                                                                                                                                            export async function uploadFile(key, buffer, contentType) {
                                                                                                                                                              await s3.send(new PutObjectCommand({
                                                                                                                                                                  Bucket: process.env.BUCKET,
                                                                                                                                                                      Key: key,
                                                                                                                                                                          Body: buffer,
                                                                                                                                                                              ContentType: contentType
                                                                                                                                                                                }));
                                                                                                                                                                                  return `https://${process.env.PUBLIC_BUCKET}/${key}`;
                                                                                                                                                                                  }custom domain (Express behind proxy)app.enable("trust proxy");
                                                                                                                                                                                  app.use((req, res, next) => {
                                                                                                                                                                                    if (req.secure) return next();
                                                                                                                                                                                      return res.redirect("https://" + req.headers.host + req.url);
                                                                                                                                                                                      });Add DNS → proxy → cert (Cloudflare / Caddy / Nginx / Certbot).import nodemailer from "nodemailer";

                                                                                                                                                                                      const mail = nodemailer.createTransport({
                                                                                                                                                                                        host: process.env.SMTP_HOST,
                                                                                                                                                                                          port: 587,
                                                                                                                                                                                            auth: { user: process.env.SMTP_USER, pass: process.env.SMTP_PASS }
                                                                                                                                                                                            });

                                                                                                                                                                                            export async function sendOwnerInvite(email, link) {
                                                                                                                                                                                              await mail.sendMail({
                                                                                                                                                                                                  to: email,
                                                                                                                                                                                                      from: "no-reply@app.example",
                                                                                                                                                                                                          subject: "You’ve been added as an owner",
                                                                                                                                                                                                              text: `Open: ${link}`
                                                                                                                                                                                                                });
                                                                                                                                                                                                                }import nodemailer from "nodemailer";

                                                                                                                                                                                                                const mail = nodemailer.createTransport({
                                                                                                                                                                                                                  host: process.env.SMTP_HOST,
                                                                                                                                                                                                                    port: 587,
                                                                                                                                                                                                                      auth: { user: process.env.SMTP_USER, pass: process.env.SMTP_PASS }
                                                                                                                                                                                                                      });

                                                                                                                                                                                                                      export async function sendOwnerInvite(email, link) {
                                                                                                                                                                                                                        await mail.sendMail({
                                                                                                                                                                                                                            to: email,
                                                                                                                                                                                                                                from: "no-reply@app.example",
                                                                                                                                                                                                                                    subject: "You’ve been added as an owner",
                                                                                                                                                                                                                                        text: `Open: ${link}`
                                                                                                                                                                                                                                          });
                                                                                                                                                                                                                                          }CI/CD — GitHub Actions pipeline
                                                                                                                                                                                                                                          .github/workflows/deploy.ymlname: Deploy
                                                                                                                                                                                                                                          on:
                                                                                                                                                                                                                                            push:
                                                                                                                                                                                                                                                branches: [ main ]

                                                                                                                                                                                                                                                jobs:
                                                                                                                                                                                                                                                  deploy:
                                                                                                                                                                                                                                                      runs-on: ubuntu-latest
                                                                                                                                                                                                                                                          steps:
                                                                                                                                                                                                                                                                - uses: actions/checkout@v4
                                                                                                                                                                                                                                                                      - uses: actions/setup-node@v4
                                                                                                                                                                                                                                                                              with: { node-version: 20 }
                                                                                                                                                                                                                                                                                    - run: npm ci
                                                                                                                                                                                                                                                                                          - run: npm run build
                                                                                                                                                                                                                                                                                                - run: npm test
                                                                                                                                                                                                                                                                                                      - name: Deploy
                                                                                                                                                                                                                                                                                                              run: ./scripts/deploy.shBackend: Node.js + Express + PostgreSQL (Knex-style queries)
                                                                                                                                                                                                                                                                                                              Frontend: React
                                                                                                                                                                                                                                                                                                              Infra: GitHub Actions + S3/R2 + HTTPS reverse proxyFeature 1 — Age-Verification Popup (Cookie-Based)
                                                                                                                                                                                                                                                                                                              Backend — route & cookie// routes/age.js
                                                                                                                                                                                                                                                                                                              const express = require("express");
                                                                                                                                                                                                                                                                                                              const router = express.Router();

                                                                                                                                                                                                                                                                                                              router.post("/verify-age", (req, res) => {
                                                                                                                                                                                                                                                                                                                if (!req.body?.confirmed) return res.status(400).json({ ok: false });

                                                                                                                                                                                                                                                                                                                  res.cookie("age_verified", "true", {
                                                                                                                                                                                                                                                                                                                      httpOnly: true,
                                                                                                                                                                                                                                                                                                                          sameSite: "lax",
                                                                                                                                                                                                                                                                                                                              secure: process.env.NODE_ENV === "production",
                                                                                                                                                                                                                                                                                                                                  maxAge: 1000 * 60 * 60 * 24 * 30
                                                                                                                                                                                                                                                                                                                                    });

                                                                                                                                                                                                                                                                                                                                      res.json({ ok: true });
                                                                                                                                                                                                                                                                                                                                      });

                                                                                                                                                                                                                                                                                                                                      module.exports = router;Mount it:app.use("/api", require("./routes/age"));Frontend — popupimport { useState, useEffect } from "react";

                                                                                                                                                                                                                                                                                                                                      export default function AgeGate() {
                                                                                                                                                                                                                                                                                                                                        const [show, setShow] = useState(false);

                                                                                                                                                                                                                                                                                                                                          useEffect(() => {
                                                                                                                                                                                                                                                                                                                                              if (!document.cookie.includes("age_verified=true")) setShow(true);
                                                                                                                                                                                                                                                                                                                                                }, []);

                                                                                                                                                                                                                                                                                                                                                  const confirm = async () => {
                                                                                                                                                                                                                                                                                                                                                      await fetch("/api/verify-age", {
                                                                                                                                                                                                                                                                                                                                                            method: "POST",
                                                                                                                                                                                                                                                                                                                                                                  headers: { "Content-Type": "application/json" },
                                                                                                                                                                                                                                                                                                                                                                        body: JSON.stringify({ confirmed: true })
                                                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                                                                setShow(false);
                                                                                                                                                                                                                                                                                                                                                                                  };

                                                                                                                                                                                                                                                                                                                                                                                    if (!show) return null;

                                                                                                                                                                                                                                                                                                                                                                                      return (
                                                                                                                                                                                                                                                                                                                                                                                          <div className="modal">
                                                                                                                                                                                                                                                                                                                                                                                                <h3>Age verification</h3>
                                                                                                                                                                                                                                                                                                                                                                                                      <p>You must confirm you are 18+ to continue.</p>
                                                                                                                                                                                                                                                                                                                                                                                                            <button onClick={confirm}>I am 18+</button>
                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                  );
                                                                                                                                                                                                                                                                                                                                                                                                                  }Feature 2 — Multi-Owner Support
                                                                                                                                                                                                                                                                                                                                                                                                                  DB migrationCREATE TABLE site_owners (
                                                                                                                                                                                                                                                                                                                                                                                                                      site_id uuid REFERENCES sites(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                        user_id uuid REFERENCES users(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                          role TEXT NOT NULL DEFAULT 'owner',
                                                                                                                                                                                                                                                                                                                                                                                                                            PRIMARY KEY (site_id, user_id)
                                                                                                                                                                                                                                                                                                                                                                                                                            );Backend — invite / removeapp.post("/sites/:id/owners", async (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                const { userId, role = "owner" } = req.body;
                                                                                                                                                                                                                                                                                                                                                                                                                                  await db("site_owners").insert({ site_id: req.params.id, user_id: userId, role });
                                                                                                                                                                                                                                                                                                                                                                                                                                    res.json({ ok: true });
                                                                                                                                                                                                                                                                                                                                                                                                                                    });

                                                                                                                                                                                                                                                                                                                                                                                                                                    app.delete("/sites/:id/owners/:userId", async (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                      await db("site_owners")
                                                                                                                                                                                                                                                                                                                                                                                                                                          .where({ site_id: req.params.id, user_id: req.params.userId })
                                                                                                                                                                                                                                                                                                                                                                                                                                              .del();
                                                                                                                                                                                                                                                                                                                                                                                                                                                res.json({ ok: true });
                                                                                                                                                                                                                                                                                                                                                                                                                                                });Authorization helperasync function assertOwner(req, siteId) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                    const match = await db("site_owners")
                                                                                                                                                                                                                                                                                                                                                                                                                                                        .where({ site_id: siteId, user_id: req.user.id })
                                                                                                                                                                                                                                                                                                                                                                                                                                                            .first();
                                                                                                                                                                                                                                                                                                                                                                                                                                                              if (!match) throw new Error("Forbidden");
                                                                                                                                                                                                                                                                                                                                                                                                                                                              }Feature 3 — Content Library & Categories
                                                                                                                                                                                                                                                                                                                                                                                                                                                              DBALTER TABLE content ADD COLUMN category TEXT;
                                                                                                                                                                                                                                                                                                                                                                                                                                                              CREATE INDEX content_category_idx ON content(category);Backendapp.get("/content", async (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const { category, q } = req.query;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const rows = await db("content")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        .modify(qb => category && qb.where({ category }))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            .modify(qb => q && qb.whereILike("title", `%${q}%`))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                .orderBy("created_at", "desc");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  res.json(rows);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  });Frontend filter UIfunction Library({ items, onFilter }) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      return (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <select onChange={e => onFilter({ category: e.target.value })}>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <option value="">All</option>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <option value="news">News</option>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <option value="guides">Guides</option>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </select>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }Feature 4 — Image Moderation Queue
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    DBALTER TABLE images ADD COLUMN status TEXT NOT NULL DEFAULT 'pending';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    CREATE INDEX images_status_idx ON images(status);Backendapp.get("/moderation/images", async (_, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        res.json(await db("images").where({ status: "pending" }));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        app.post("/moderation/images/:id/approve", async (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          await db("images").where({ id: req.params.id }).update({ status: "approved" });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            res.json({ ok: true });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            app.post("/moderation/images/:id/reject", async (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              await db("images").where({ id: req.params.id }).update({ status: "rejected" });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                res.json({ ok: true });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });Frontend reviewer tablefunction ModerationQueue({ items, onApprove, onReject }) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return items.map(img => (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div key={img.id}>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <img src={img.url} alt="" />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <button onClick={() => onApprove(img.id)}>Approve</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <button onClick={() => onReject(img.id)}>Reject</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }Feature 5 — S3 / Cloudflare R2 Storage Option
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Uploader utilUploader utilimport { S3Client, PutObjectCommand } from "@aws-sdk/client-s3";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const s3 = new S3Client({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  region: "auto",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    endpoint: process.env.R2_ENDPOINT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      credentials: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          accessKeyId: process.env.R2_KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              secretAccessKey: process.env.R2_SECRET
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                export async function uploadFile({ key, buffer, contentType }) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  await s3.send(new PutObjectCommand({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Bucket: process.env.BUCKET,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Key: key,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Body: buffer,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ContentType: contentType
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      return `https://${process.env.PUBLIC_BUCKET}/${key}`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }import { S3Client, PutObjectCommand } from "@aws-sdk/client-s3";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const s3 = new S3Client({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        region: "auto",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          endpoint: process.env.R2_ENDPOINT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            credentials: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                accessKeyId: process.env.R2_KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    secretAccessKey: process.env.R2_SECRET
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      export async function uploadFile({ key, buffer, contentType }) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        await s3.send(new PutObjectCommand({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Bucket: process.env.BUCKET,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Key: key,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Body: buffer,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ContentType: contentType
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return `https://${process.env.PUBLIC_BUCKET}/${key}`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        API upload                                    }app.post("/upload", async (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const file = req.file; // e.g., multer
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const url = await uploadFile({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  key: `uploads/${Date.now()}-${file.originalname}`,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      buffer: file.buffer,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          contentType: file.mimetype
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              res.json({ url });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              });Feature 6 — HTTPS + Custom Domain Redirect
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Force HTTPS in Express (behind proxy)app.enable("trust proxy");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              app.use((req, res, next) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (req.secure || req.headers["x-forwarded-proto"] === "https") return next();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  res.redirect(`https://${req.headers.host}${req.url}`);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  });Feature 7 — Email Sending (Owner Onboarding)Mailerimport nodemailer from "nodemailer";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const mailer = nodemailer.createTransport({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    host: process.env.SMTP_HOST,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      port: 587,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        secure: false,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          auth: { user: process.env.SMTP_USER, pass: process.env.SMTP_PASS }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          export async function sendOwnerInvite({ email, link }) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            await mailer.sendMail({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                to: email,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    from: "no-reply@app.example",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        subject: "You’ve been added as an owner",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            text: `You were invited to manage a site.\nOpen: ${link}`,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                html: `<p>You were invited to manage a site.</p><p><a href="${link}">Open invite</a></p>`
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }API integrationapp.post("/sites/:id/owners/invite", async (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const { email } = req.body;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const link = `${process.env.APP_URL}/accept?site=${req.params.id}`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          await sendOwnerInvite({ email, link });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            res.json({ ok: true });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });Feature 8 — CI/CD GitHub Actions Pipeline
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Workflow# .github/workflows/deploy.yml
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            name: CI & Deploy
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            on:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              push:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  branches: [ main ]

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  jobs:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    build-test-deploy:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            steps:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - uses: actions/checkout@v4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - uses: actions/setup-node@v4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          node-version: 20
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - run: npm ci
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - run: npm run lint
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - run: npm test
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - run: npm run build
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - name: Deploy
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                env:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          SSH_KEY: ${{ secrets.SSH_KEY }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  run: ./scripts/deploy.shExample scripts/deploy.sh#!/usr/bin/env bash
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  set -e
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ssh -i "$SSH_KEY" user@server "
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cd /var/www/app &&
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      git pull &&
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        npm ci &&
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          pm2 restart app
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Backend: Node.js + Express + PostgreSQL (Knex-style)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Frontend: React (SPA)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Auth assumption: req.user.id available after auth middleware
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Tests: Jest + Supertest
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Infra: GitHub Actions, S3/R2, HTTPS proxy
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          If your stack differs, tell me and I’ll adapt everything.Age-Verification Popup — Full Implementation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Route// routes/age.js
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const express = require("express");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const router = express.Router();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          router.post("/verify-age", (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (!req.body?.confirmed) return res.status(400).json({ ok: false });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              res.cookie("age_verified", "true", {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  httpOnly: true,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      sameSite: "lax",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          secure: process.env.NODE_ENV === "production",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              maxAge: 1000 * 60 * 60 * 24 * 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  res.json({ ok: true });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  module.exports = router;Mount:app.use("/api", require("./routes/age"));Frontend Componentimport { useState, useEffect } from "react";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  export default function AgeGate() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const [show, setShow] = useState(false);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      useEffect(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (!document.cookie.includes("age_verified=true")) setShow(true);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }, []);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const confirm = async () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  await fetch("/api/verify-age", {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        method: "POST",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              headers: { "Content-Type": "application/json" },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    body: JSON.stringify({ confirmed: true })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setShow(false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (!show) return null;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  return (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div className="modal">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <h3>Age verification</h3>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <button onClick={confirm}>I am 18+</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }import { useState, useEffect } from "react";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        export default function AgeGate() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const [show, setShow] = useState(false);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            useEffect(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (!document.cookie.includes("age_verified=true")) setShow(true);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }, []);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const confirm = async () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        await fetch("/api/verify-age", {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              method: "POST",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    headers: { "Content-Type": "application/json" },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          body: JSON.stringify({ confirmed: true })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  setShow(false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if (!show) return null;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="modal">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <h3>Age verification</h3>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <button onClick={confirm}>I am 18+</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }Testimport request from "supertest";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              import app from "../app";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              it("sets cookie on confirm", async () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const res = await request(app)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    .post("/api/verify-age")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        .send({ confirmed: true });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          expect(res.status).toBe(200);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            expect(res.headers["set-cookie"][0]).toContain("age_verified=true");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });) Multi-Owner Support — Full Implementation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            MigrationCREATE TABLE site_owners (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                site_id uuid REFERENCES sites(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  user_id uuid REFERENCES users(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    role TEXT NOT NULL DEFAULT 'owner',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      PRIMARY KEY (site_id, user_id)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      );Authorization Helperexport async function requireOwner(req, siteId) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const row = await db("site_owners")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .where({ site_id: siteId, user_id: req.user.id })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  .first();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!row) return req.res.status(403).json({ error: "Forbidden" });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }Routesapp.post("/sites/:id/owners", async (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        await requireOwner(req, req.params.id);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const { userId, role = "owner" } = req.body;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            await db("site_owners").insert({ site_id: req.params.id, user_id: userId, role });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              res.json({ ok: true });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              app.delete("/sites/:id/owners/:userId", async (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await requireOwner(req, req.params.id);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  await db("site_owners")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      .where({ site_id: req.params.id, user_id: req.params.userId })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          .del();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            res.json({ ok: true });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });Testit("adds owner", async () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const res = await request(app)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    .post("/sites/123/owners")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        .set(authHeader(ownerUser))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            .send({ userId: otherUser });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              expect(res.body.ok).toBe(true);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              });3) Content Library & Categories — Full Implementation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              MigrationALTER TABLE content ADD COLUMN category TEXT;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              CREATE INDEX content_category_idx ON content(category);APIapp.get("/content", async (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const { category, q } = req.query;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const rows = await db("content")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        .modify(qb => category && qb.where({ category }))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            .modify(qb => q && qb.whereILike("title", `%${q}%`))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                .orderBy("created_at", "desc");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  res.json(rows);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  });UI Filterexport function ContentFilters({ onChange }) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      return (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <select onChange={e => onChange({ category: e.target.value })}>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <option value="">All</option>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <option value="news">News</option>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <option value="guides">Guides</option>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </select>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }Testit("filters by category", async () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const res = await request(app).get("/content?category=news");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        expect(res.status).toBe(200);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });Image Moderation Queue — Full Implementation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        MigrationAPIapp.get("/moderation/images", async (_, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            res.json(await db("images").where({ status: "pending" }));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            app.post("/moderation/images/:id/:action", async (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const action = req.params.action;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const status = action === "approve" ? "approved" : "rejected";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  await db("images").where({ id: req.params.id }).update({ status });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    res.json({ ok: true });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    });UIexport function ModerationRow({ img, onAction }) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <img src={img.url} alt="" />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <button onClick={() => onAction(img.id, "approve")}>Approve</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <button onClick={() => onAction(img.id, "reject")}>Reject</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }UIexport function ModerationRow({ img, onAction }) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <img src={img.url} alt="" />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <button onClick={() => onAction(img.id, "approve")}>Approve</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <button onClick={() => onAction(img.id, "reject")}>Reject</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }Testit("approves image", async () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const res = await request(app).post("/moderation/images/1/approve");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          expect(res.body.ok).toBe(true);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          });S3 / Cloudflare R2 — Full Implementation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Uploaderimport { S3Client, PutObjectCommand } from "@aws-sdk/client-s3";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          export const s3 = new S3Client({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            region: "auto",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              endpoint: process.env.R2_ENDPOINT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                credentials: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    accessKeyId: process.env.R2_KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        secretAccessKey: process.env.R2_SECRET
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          export async function uploadFile({ key, buffer, contentType }) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            await s3.send(new PutObjectCommand({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Bucket: process.env.BUCKET,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Key: key,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Body: buffer,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ContentType: contentType
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return `https://${process.env.PUBLIC_BUCKET}/${key}`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }Testit("uploads to R2", async () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const res = await request(app)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        .post("/upload")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            .attach("file", Buffer.from("hi"), "x.txt");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              expect(res.body.url).toMatch(/^https:\/\/.+/);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              });HTTPS + Custom Domain — Full Implementation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Force HTTPSapp.enable("trust proxy");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              app.use((req, res, next) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (req.secure || req.headers["x-forwarded-proto"] === "https") return next();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  res.redirect(`https://${req.headers.host}${req.url}`);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  });Provision TLS via Caddy / Nginx / Cloudflare — point DNS → proxy → app.Smoke Testit("redirects http → https", async () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const res = await request(app)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          .get("/")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .set("x-forwarded-proto", "http");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                expect(res.status).toBe(302);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });✉️ 7) Email Sending (Owner Onboarding)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Mailer + Templateimport nodemailer from "nodemailer";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const mailer = nodemailer.createTransport({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  host: process.env.SMTP_HOST,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    port: 587,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      secure: false,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        auth: { user: process.env.SMTP_USER, pass: process.env.SMTP_PASS }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        export async function sendOwnerInvite({ email, link }) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          await mailer.sendMail({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              to: email,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  from: "no-reply@app.example",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      subject: "You’ve been added as an owner",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          html: `<p>You were invited to manage a site.</p><p><a href="${link}">Accept invite</a></p>`
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }APIapp.post("/sites/:id/owners/invite", async (req, res) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const link = `${process.env.APP_URL}/accept?site=${req.params.id}`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  await sendOwnerInvite({ email: req.body.email, link });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    res.json({ ok: true });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    });Test (mock transport)jest.mock("nodemailer");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    it("sends invite", async () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const res = await request(app)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          .post("/sites/1/owners/invite")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .send({ email: "a@test.com" });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                expect(res.body.ok).toBe(true);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });CI/CD — GitHub Actions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Workflow name: CI & Deploy
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                on:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  push: { branches: [ main ] }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  jobs:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    build-test-deploy:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            steps:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - uses: actions/checkout@v4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - uses: actions/setup-node@v4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                with: { node-version: 20 }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - run: npm ci
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - run: npm run lint
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - run: npm test
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - run: npm run build
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: Deploy
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      run: ./scripts/deploy.sh
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              env:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        SSH_KEY: ${{ secrets.SSH_KEY }}Deploy Script#!/usr/bin/env bash
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        set -e
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ssh -i "$SSH_KEY" user@server "
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          cd /var/www/app &&
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            git pull &&
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              npm ci &&
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                pm2 restart app
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            )
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                              })
                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                            })
                                                                                                                                                                                                                                                                                                                                                                                                                  )
                                                                                                                                    })
                                                                                                                    })
                                                                                                             })                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Path uploadDir = Paths.get("uploads/logos");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Files.createDirectories(uploadDir);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Path filePath = uploadDir.resolve(logoFile.getOriginalFilename());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Files.copy(logoFile.getInputStream(), filePath, StandardCopyOption.REPLACE_EXISTING);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                owner.setLogoPath("/uploads/logos/" + logoFile.getOriginalFilename());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                repo.save(owner);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return "redirect:/owner/login";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }Login (Firebase token verification filter)// src/main/java/com/example/site/controller/DashboardController.java
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            package com.example.site.controller;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            import org.springframework.stereotype.Controller;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            import org.springframework.web.bind.annotation.GetMapping;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            @Controller
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            public class DashboardController {

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @GetMapping("/owner/dashboard")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    public String dashboard() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return "dashboard";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }<!-- templates/dashboard.html -->
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <!DOCTYPE html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <head>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <link rel="stylesheet" href="/styles.css">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <title>Owner Dashboard</title>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </head>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="header-line"><h1>Website Owner Dashboard</h1></div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <p>Welcome! Manage your site, logo, and settings here.</p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </html>Theme Styles (dark grey / orange / gold / blue→green)/* static/styles.css */
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        body {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          background: #2b2b2b;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            color: #ff8c00;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              font-family: Arial, sans-serif;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              .header-line {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                border-bottom: 3px solid #ffd700;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  margin-bottom: 12px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  input, button {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    padding: 8px 12px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      border-radius: 6px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        border: none;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          margin-top: 6px;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          button {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            background: #1e6fdc;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              cursor: pointer;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              button:hover {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                background: #2aa84a;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }🧰 1) Install prerequisites
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                You’ll need:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Java 17+
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Maven
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Node.js (optional frontend)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                PostgreSQL (local or Railway)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Git
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Firebase project + service accountLocal setupgit clone <your-repo-url>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cd site
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                mvn clean spring-boot:runCreate a file called .env (not committed):SPRING_DATASOURCE_URL=jdbc:postgresql://localhost:5432/sexsite
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                SPRING_DATASOURCE_USERNAME=postgres
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                SPRING_DATASOURCE_PASSWORD=YOUR_DB_PASSWORD

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                FIREBASE_SERVICE_ACCOUNT=<paste service-account-json-here>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                UPLOAD_DIR=/uploads/logosexport $(cat .env | xargs)Windows (PowerShell):Get-Content .env | ForEach-Object {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      $name,$value = $_ -split "="
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setx $name $value
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }Create database:CREATE DATABASE sexsite;4) Firebase Storage for logo uploads (recommended)<dependency>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <groupId>com.google.firebase</groupId>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <artifactId>firebase-admin</artifactId>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </dependency>Upload instead of writing to disk:Bucket bucket = StorageClient.getInstance().bucket();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            String fileName = "logos/" + logoFile.getOriginalFilename();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            bucket.create(fileName, logoFile.getInputStream(), logoFile.getContentType());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            owner.setLogoPath("gs://" + bucket.getName() + "/" + fileName);Docker support
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Create Dockerfile:FROM eclipse-temurin:17-jdk
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            WORKDIR /app
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            COPY . .
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            RUN ./mvnw -q -DskipTests package
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            CMD ["java","-jar","target/site-0.0.1-SNAPSHOT.jar"]Build & run:docker build -t sexsite .
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            docker run -p 8080:8080 --env-file .env sexsiteDeploy backend to Railway
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Push repo to GitHub
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            In Railway → New Project → Deploy from GitHub
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Add environment variables from .env
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Add PostgreSQL plugin (creates DB + URL)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Set PORT=8080
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Deploy
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Optional Procfile (Railway auto-detects Java, but safe):web: java -jar target/site-0.0.1-SNAPSHOT.jarOptional Vercel frontend pairing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            If you later want a separate frontend:npx create-next-app site-frontendConfigure .env.local:NEXT_PUBLIC_API_URL=https://<railway-app-url>Deploy to Vercel:vercelAdmin / moderation starter actions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Add endpoints for:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            deleting uploaded images
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            suspending content
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            banning users (via Firebase)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            audit logs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Example admin action:@PostMapping("/admin/delete-owner/{id}")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            public String deleteOwner(@PathVariable Long id) throws Exception {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                var owner = repo.findById(id).orElseThrow();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (owner.getFirebaseUid() != null) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            FirebaseAuth.getInstance().deleteUser(owner.getFirebaseUid());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    repo.deleteById(id);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return "redirect:/admin";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }Smoke-test checklist
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        After deploy, verify:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        / → age-gate works
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        /owner/register → creates Firebase user + DB entry
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Logo uploads store correctly
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Login → dashboard access enforced
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Database persists records
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Railway logs show no errors
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }